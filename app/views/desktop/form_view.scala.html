@(page: Page)
@import models.Page

@for(field <- page.fields) {
    @if(field.showInFormView) {
        <div class="form-group" ng-class="{'has-error': TopPageForm.@(field.name).$invalid}">
            @if(field.fieldType == "text") {
                <label class="control-label" for="@(page.model.name)-@(field.name)">@field.label</label>
                <input type="text" class="form-control" id="@(page.model.name)-@(field.name)" name="@(field.name)"
                data-ng-model="current.instances.@(page.model.name).data.@(field.name)"
                ng-change="rowChanged(current.instances.@(page.model.name))"
                @if(field.blurFunction.isDefined) {
                    ng-blur="@Html(field.blurFunction.get)"
                }
                @if(field.placeholder.isDefined) {
                    placeholder="@field.placeholder.get"
                }
                @if(field.required) {
                    ng-required="current.instances.@(page.model.name)"
                }
                @if(field.disabled) {
                    disabled="disabled"
                }
                @if(field.help.isDefined) {
                    aria-describedby="help-@(page.model.name)-@(field.name)"
                }
                >
                @for(link <- field.links.getOrElse(Seq.empty)) {
                    <a href="" data-ng-click="link('@link.page', '@link.filter', '@page.model.name')">{{title}}</a>
                }
                @if(field.help.isDefined) {
                    <span id="help-@(page.model.name)-@(field.name)" class="help-block">@Html(field.help.get)</span>
                }
            }
            @if(field.fieldType == "select") {
                <label class="control-label" for="@(page.model.name)-@field.name">@field.label</label>
                <ui-select
                current="current.instances.@(page.model.name).data"
                item-model="@field.select.get.model"
                item-value="@field.select.get.sourceValue"
                item-where="@field.select.get.where"
                instance-model="@page.model.name"
                instance-key="@field.select.get.targetID"
                instance-value="@(field.name)"
                other-mappings="@Html(field.select.get.otherMappings.toString)"
                ></ui-select>
            }
            @if(field.fieldType == "checkbox") {
                <div class="checkbox">
                    <label class="control-label" class="ui-checkbox" for="@(page.model.name)-@(field.name)">
                        <input type="checkbox" id="@(page.model.name)-@(field.name)"
                        data-ng-model="current.instances.@(page.model.name).data.@(field.name)"
                        ng-change="rowChanged(current.instances.@(page.model.name), '@(field.name)')">
                        @field.label
                    </label>
                </div>
            }
        </div>
    }
}
